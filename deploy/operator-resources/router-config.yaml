# Router configuration for Apollo Router
#
# This configuration is loaded via a ConfigMap and mounted into the router pods.
# The script 07-deploy-operator-resources.sh:
#   1. Creates a ConfigMap from this file
#   2. Patches the router deployment to mount the ConfigMap as a volume at /etc/router
#   3. Patches the router deployment to add --config /etc/router/router.yaml as container args
#
# Note: The Apollo GraphOS Operator CRD does not support router configuration
# in the Supergraph CRD, so we patch the deployment manually after it's created.

supergraph:
  listen: 0.0.0.0:4000
  introspection: true

headers:
  all:
    request:
      - propagate:
          matching: .*

authentication:
  router:
    jwt:
      jwks:
        - url: http://graphql.users.svc.cluster.local:4001/.well-known/jwks.json

authorization:
  directives:
    enabled: true

cors:
  allow_any_origin: true

coprocessor:
  url: http://coprocessor.apollo.svc.cluster.local:8081
  timeout: 2s
  router:
    request:
      headers: true
  subgraph:
    all:
      request:
        headers: true
      response:
        headers: true

health_check:
  listen: 0.0.0.0:8080

sandbox:
  enabled: true

homepage:
  enabled: false

include_subgraph_errors:
  all: true

plugins:
  experimental:
    expose_query_plan: true

